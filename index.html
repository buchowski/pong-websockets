<!DOCTYPE html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <style>
      #board {
        height: 50vw;
        background-color: dimgray;
      }
      #left-ball {
        fill: red;
      }
      #right-ball {
        fill: lightskyblue;
      }
    </style>
  </head>
  <body>
    <svg id="board">
      <circle id="left-ball" r="10" />
      <circle id="right-ball" r="10" />
    </svg>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      var socket = io();  
      let leftX = 50;
      let leftY = 100;
      let prevLeftX = leftX;
      let prevLeftY = leftY;
      let deltaX = 3;
      let deltaY = 3;
      let hasUpdatedPos = true;

      var board = document.getElementById('board');
      const leftBall = document.getElementById('left-ball');

      // initialize
      leftBall.setAttribute('cx', leftX);
      leftBall.setAttribute('cy', leftY);

      // emit websocket msg if ball pos has changed
      setInterval(emitMessageLoop = () => {
        hasUpdatedPos = leftX !== prevLeftX || leftY !== prevLeftY;

        if (hasUpdatedPos) {
          prevLeftX = leftX;
          prevLeftY = leftY;
          socket.emit('ballMove', {id: 'leftPlayer', x: leftX, y: leftY});
        }
      }, 50);

      // wasd controls ball pos
      document.addEventListener('keydown', function(e) {
        e.preventDefault();

        switch (e.key) {
          case 'w':
            leftY -= deltaY;
            leftBall.setAttribute('cy', leftY)
            break;
          case 's':
            leftY += deltaY;
            leftBall.setAttribute('cy', leftY) 
            break;
          case 'd':
            leftX += deltaX;
            leftBall.setAttribute('cx', leftX) 
            break;
          case 'a':
            leftX -= deltaX;
            leftBall.setAttribute('cx', leftX) 
        }
      });
    </script>
  </body>
</html>